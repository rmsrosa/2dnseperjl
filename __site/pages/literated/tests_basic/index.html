<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="" />
  <meta name="author" content="and contributors" />
   <title>Direct and inverse FFTW</title>  
  <link rel="shortcut icon" type="image/png" href="/2dnsepervortjl/assets/images/favicon.png"/>
  <link rel="stylesheet" href="/2dnsepervortjl/css/base.css"/>
  
    <link rel="stylesheet" href="/2dnsepervortjl/css/base_showaside.css"/>
  
  <script src="/2dnsepervortjl/libs/mousetrap/mousetrap.min.js"></script>

  
    <link rel="stylesheet" href="/2dnsepervortjl/libs/highlight/github.min.css">
    <script src="/2dnsepervortjl/libs/highlight/highlight.pack.js"></script>
    <script src="/2dnsepervortjl/libs/highlight/julia.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre').forEach((el) => {
          hljs.highlightElement(el);
        });
      });
    </script>
  

  
    <link rel="stylesheet" href="/2dnsepervortjl/libs/katex/katex.min.css">
  
</head>

<body>

  <div class="books-container">

  <aside class="books-menu">
  <input type="checkbox" id="menu">
  <label for="menu">☰</label>

  <div class="books-title">
    <a href="/2dnsepervortjl/">Two-dimensional periodic flows</a>
  </div>

  <br />

  <div class="books-subtitle">
    Pseudo-spectral simulation in Julia
  </div>

  <br />

  <div class="books-author">
    <a href="https://rmsrosa.github.io">Ricardo M. S. Rosa</a>
  </div>

  <div class="books-menu-content">
    <div class="menu-level-1">
    <li><a href="/2dnsepervortjl/pages/intro">Introduction</a></li>
    </div>
    <div class="menu-level-1">
    <li>1. Mathematical Formulation</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/pressure-velocity">1.1. Pressure-velocity formulation</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/vorticity">1.2. Vorticity formulation</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/basdevant">1.3. Basdevant reduction</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/stream">1.4. Stream function</a></li>
    </div>
    <div class="menu-level-1">
    <li>2. Spectral Formulation</li>
    </div>
    <div class="menu-level-1">
    <li>3. Discrete Fourier Transform</li>
    </div>
    <div class="menu-level-1">
    <li>4. Physical Quantities</li>
    </div>
    <div class="menu-level-1">
    <li>5. Two-dimensional turbulence</li>
    </div>
    <div class="menu-level-1">
    <li>6. FFTW Tests</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/literated/tests_basic">6.1. Direct and inverse FFTW</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/literated/tests_fft_plan">6.2. FFTW plans</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/literated/benchmark_fft_plan">6.3. Benchmarking flags for FFTW plans</a></li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/literated/tests_bilinear">6.4. Approximations of the bilinear term</a></li>
    </div>
    <div class="menu-level-1">
    <li>7. Evolution Tests</li>
    </div>
    <div class="menu-level-2">
    <li><a href="/2dnsepervortjl/pages/literated/tests_mol">7.1. Evolution via method of lines</a></li>
    </div>
    <div class="menu-level-1">
    <li>8. Simulations</li>
    </div>
    <div class="menu-level-1">
    <li><a href="/2dnsepervortjl/pages/references">9. References</a></li>
    </div>
<div>


  
    <a href="https://github.com/rmsrosa/2dnsepervortjl"><img src="/2dnsepervortjl/assets/images/GitHub-Mark-32px.png" alt="GitHub repo" width="18" style="margin:5px 5px" align="left"></a>

  

</aside>


  <div class="books-content">

    
      <div class="navbar">
    <p id="nav">
<span id="nav-prev" style="float: left;">
<a class="menu-level-1" href="/2dnsepervortjl/pages/stream">1.4. Stream function <kbd>←</kbd></a>
</span>
<span id="nav-next" style="float: right;">
    <a class="menu-level-1" href="/2dnsepervortjl/pages/literated/tests_fft_plan"><kbd>→</kbd> 6.2. FFTW plans</a>
</span>
    </p>
</div>
</br></br>

    

    
      <div class="badges">
<p>
<a href="https://nbviewer.org/urls/rmsrosa.github.io/2dnsepervortjl/generated/literated/tests_basic.ipynb"><img align="left" src="https://img.shields.io/badge/view%20in-nbviewer-orange" alt="View in NBViewer" title="View Jupyter notebook in NBViewer"></a>
<a href="https://mybinder.org/v2/gh/rmsrosa/2dnsepervortjl/binderenv?urlpath=git-pull%3Frepo%3Dhttps://github.com/rmsrosa/2dnsepervortjl%26urlpath%3Dlab/tree%252F2dnsepervortjl/generated/literated/tests_basic.ipynb%26branch%3Dgh-pages"><img align="left" src="https://mybinder.org/badge.svg" alt="Open in binder" title="Open in binder"></a>
<a href="/2dnsepervortjl/generated/literated/tests_basic.ipynb"><img align="left" src="https://img.shields.io/badge/download-notebook-blue" alt="Download notebook" title="Download Jupyter notebook"></a>
<a href="/2dnsepervortjl/src/literate/tests_basic.jl"><img align="left" src="https://img.shields.io/badge/view-source-lightblue" alt="View source" title="View source"></a>
</p>
</div></br>

    
<h1 id="get_title"><a href="#get_title" class="header-anchor">6.1. Direct and inverse FFTW</a></h1>
<p>Here we test the methods, in FFTW, to be used in our pseudo-spectral code. It is mostly a sanity check.</p>
<p>We start by loading the packages we need:</p>
<pre><code class="language-julia">using FFTW
using WGLMakie
using Test</code></pre>
<h2 id="the_spatial_domain_and_its_discretization"><a href="#the_spatial_domain_and_its_discretization" class="header-anchor">The spatial domain and its discretization</a></h2>
<p>We consider a square domain of sides <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mn>2</mn><mi>π</mi></mrow><annotation encoding="application/x-tex">L = 2\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span>, for which the smallest wavenumber is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>κ</mi><mn>0</mn></msub><mo>=</mo><mn>2</mn><mi>π</mi><mi mathvariant="normal">/</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">\kappa_0 = 2\pi/L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">κ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord">/</span><span class="mord mathnormal">L</span></span></span></span>.</p>
<pre><code class="language-julia">L &#61; 2π
κ₀ &#61; 2π/L
nothing</code></pre>
<p>We set the number <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> of points for the mesh in each direction, yielding a mesh <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>j</mi></msub><msub><mo stretchy="false">)</mo><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>N</mi></mrow></msub></mrow><annotation encoding="application/x-tex">(x_i, y_j)_{i, j = 1,\ldots ,N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="minner mtight">…</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>, with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>N</mi></msub><mo>=</mo><msub><mi>y</mi><mi>N</mi></msub><mo>=</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">x_N = y_N = L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span>, and steps <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><mi>L</mi><mi mathvariant="normal">/</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">x_{i+1} - x_i = L/N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>y</mi><mi>j</mi></msub><mo>=</mo><mi>L</mi><mi mathvariant="normal">/</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">y_{j+1} - y_j = L/N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>. Due to the periodicity, we don&#39;t need to store the values corresponding to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mi>j</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i = j = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>.</p>
<pre><code class="language-julia">N &#61; 128
x &#61; y &#61; &#40;L/N&#41;:&#40;L/N&#41;:L
nothing</code></pre>
<p>We may visualize the grid with a scatter plot, although if the mesh is too thin, we won&#39;t quite see the details. If using GLMakie or WGLMakie, one can zoom in for a detailed view.</p>
<pre><code class="language-julia">fig, ax, plt &#61; scatter&#40;vec&#40;x .* one.&#40;y&#41;&#39;&#41;, vec&#40;one.&#40;x&#41; .* y&#39;&#41;&#41;

fig</code></pre>

<div data-jscall-id="2"><script data-jscall-id="3" type="text/javascript">
    function register_resize_handler(remote_origin) {
        function resize_callback(event) {
            if (event.origin !== remote_origin) {
                return;
            }
            const uuid = event.data[0];
            const width = event.data[1];
            const height = event.data[2];
            const iframe = document.getElementById('75e60e23-2474-4e2a-9507-95a5bf75f22c');
            if (iframe) {
                iframe.style.width = width + "px";
                iframe.style.height = height + "px";
            }
        }
        if (window.addEventListener) {
            window.addEventListener("message", resize_callback, false);
        } else if (window.attachEvent) {
            window.attachEvent("onmessage", resize_callback);
        }
    }
    register_resize_handler('http://127.0.0.1:9284')

</script><iframe scrolling="no" id="75e60e23-2474-4e2a-9507-95a5bf75f22c" data-jscall-id="1" src="http://127.0.0.1:9284/75e60e23-2474-4e2a-9507-95a5bf75f22c" style="position: relative; display: block; width: 100%; height: 100%; padding: 0; overflow: hidden; border: none"></iframe></div>


<h2 id="a_vorticity_function_for_testing"><a href="#a_vorticity_function_for_testing" class="header-anchor">A vorticity function for testing</a></h2>
<p>In order to test the methods from <a href="http://www.fftw.org">FFTW.jl</a>, we define a certain vorticity function and its derivatives</p>
<pre><code class="language-julia">vort &#61; sin.&#40;one.&#40;y&#41; * x&#39;&#41; .* cos.&#40;3y * one.&#40;x&#41;&#39;&#41;
dx_vort &#61; cos.&#40;one.&#40;y&#41; * x&#39;&#41; .* cos.&#40;3y * one.&#40;x&#41;&#39;&#41;
dy_vort &#61; - 3 * sin.&#40;one.&#40;y&#41; * x&#39;&#41; .* sin.&#40;3y * one.&#40;x&#41;&#39;&#41;
dd_vort &#61; - sin.&#40;one.&#40;y&#41; * x&#39;&#41; .* cos.&#40;3y * one.&#40;x&#41;&#39;&#41; - 9 * sin.&#40;one.&#40;y&#41; * x&#39;&#41; .* cos.&#40;3y * one.&#40;x&#41;&#39;&#41;

nothing</code></pre>
<p>We may visualize the vorticity as a surface:</p>
<pre><code class="language-julia">fig &#61; Figure&#40;backgroundcolor &#61; RGBf&#40;0.98, 0.98, 0.98&#41;&#41;

ax &#61; Axis3&#40;fig&#91;1, 1&#93;, xlabel &#61; &quot;x&quot;, ylabel &#61; &quot;y&quot;, zlabel &#61; &quot;vorticity level&quot;, title &#61; &quot;Vorticity graph&quot;&#41;

surface&#33;&#40;ax, x, y, vort, colormap &#61; :berlin&#41;

fig</code></pre>

<div data-jscall-id="5"><script data-jscall-id="6" type="text/javascript">
    function register_resize_handler(remote_origin) {
        function resize_callback(event) {
            if (event.origin !== remote_origin) {
                return;
            }
            const uuid = event.data[0];
            const width = event.data[1];
            const height = event.data[2];
            const iframe = document.getElementById('feff30a8-2b65-4c33-8209-7ab852f645ea');
            if (iframe) {
                iframe.style.width = width + "px";
                iframe.style.height = height + "px";
            }
        }
        if (window.addEventListener) {
            window.addEventListener("message", resize_callback, false);
        } else if (window.attachEvent) {
            window.attachEvent("onmessage", resize_callback);
        }
    }
    register_resize_handler('http://127.0.0.1:9284')

</script><iframe scrolling="no" id="feff30a8-2b65-4c33-8209-7ab852f645ea" data-jscall-id="4" src="http://127.0.0.1:9284/feff30a8-2b65-4c33-8209-7ab852f645ea" style="position: relative; display: block; width: 100%; height: 100%; padding: 0; overflow: hidden; border: none"></iframe></div>


<p>Or, better yet, as a heatmap:</p>
<pre><code class="language-julia">fig, ax, plt &#61; heatmap&#40;x, y, vort, colormap &#61; :berlin&#41;

ax &#61; Axis&#40;fig&#91;1, 1&#93;, xlabel &#61; &quot;x&quot;, ylabel &#61; &quot;y&quot;, title &#61; &quot;Vorticity heatmap&quot;&#41;

fig</code></pre>

<div data-jscall-id="8"><script data-jscall-id="9" type="text/javascript">
    function register_resize_handler(remote_origin) {
        function resize_callback(event) {
            if (event.origin !== remote_origin) {
                return;
            }
            const uuid = event.data[0];
            const width = event.data[1];
            const height = event.data[2];
            const iframe = document.getElementById('58272d65-2ced-4ca8-a3f1-f38f13605e41');
            if (iframe) {
                iframe.style.width = width + "px";
                iframe.style.height = height + "px";
            }
        }
        if (window.addEventListener) {
            window.addEventListener("message", resize_callback, false);
        } else if (window.attachEvent) {
            window.attachEvent("onmessage", resize_callback);
        }
    }
    register_resize_handler('http://127.0.0.1:9284')

</script><iframe scrolling="no" id="58272d65-2ced-4ca8-a3f1-f38f13605e41" data-jscall-id="7" src="http://127.0.0.1:9284/58272d65-2ced-4ca8-a3f1-f38f13605e41" style="position: relative; display: block; width: 100%; height: 100%; padding: 0; overflow: hidden; border: none"></iframe></div>


<h2 id="testing_the_direct_and_inverse_discrete_fourier_transform"><a href="#testing_the_direct_and_inverse_discrete_fourier_transform" class="header-anchor">Testing the direct and inverse discrete Fourier transform</a></h2>
<p>We check going back and forth with the real fft and inverse real fft:</p>
<pre><code class="language-julia">@testset &quot;check composition &#96;irfft ∘ rfft&#96;&quot; begin
    vort_hat &#61; rfft&#40;vort&#41;
    vortback &#61; irfft&#40;vort_hat, N&#41;
    @test vort ≈ vortback
end
nothing</code></pre>
<pre><code class="language-julia">Test Summary:                    | Pass  Total
check composition &#96;irfft ∘ rfft&#96; |    1      1</code></pre>
<p>We can also visualize the excited modes:</p>
<pre><code class="language-julia">κ_x &#61; κ₀ * &#40;0:1/N:1/2&#41;
κ_y &#61; κ₀ * &#40;0:1/N:1-1/N&#41;

vort_hat &#61; rfft&#40;vort&#41;

fig, ax, plt &#61; heatmap&#40;κ_x, κ_y, abs.&#40;vort_hat&#41;.^2, colormap &#61; :berlin&#41;

ax &#61; Axis&#40;fig&#91;1, 1&#93;, xlabel &#61; &quot;k_x&quot;, ylabel &#61; &quot;k_y&quot;, title &#61; &quot;Enstrophy spectrum heatmap&quot;&#41;

fig</code></pre>

<div data-jscall-id="11"><script data-jscall-id="12" type="text/javascript">
    function register_resize_handler(remote_origin) {
        function resize_callback(event) {
            if (event.origin !== remote_origin) {
                return;
            }
            const uuid = event.data[0];
            const width = event.data[1];
            const height = event.data[2];
            const iframe = document.getElementById('42891465-d5e6-4128-a53e-baa824959c15');
            if (iframe) {
                iframe.style.width = width + "px";
                iframe.style.height = height + "px";
            }
        }
        if (window.addEventListener) {
            window.addEventListener("message", resize_callback, false);
        } else if (window.attachEvent) {
            window.attachEvent("onmessage", resize_callback);
        }
    }
    register_resize_handler('http://127.0.0.1:9284')

</script><iframe scrolling="no" id="42891465-d5e6-4128-a53e-baa824959c15" data-jscall-id="10" src="http://127.0.0.1:9284/42891465-d5e6-4128-a53e-baa824959c15" style="position: relative; display: block; width: 100%; height: 100%; padding: 0; overflow: hidden; border: none"></iframe></div>


<p>We have excited modes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo>±</mo><mn>1</mn><mo separator="true">,</mo><mo>±</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\pm 1, \pm 3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">±</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">±</span><span class="mord">3</span><span class="mclose">)</span></span></span></span>. Due to the reality condition of the vorticity, the Fourier spectrum has an Hermitian symmetry around the origin. Using the real Fourier transform, only half of the modes need to be stored. In this case, only modes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mo>±</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1, \pm 3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">±</span><span class="mord">3</span><span class="mclose">)</span></span></span></span> are retained. Moreover, the negative modes are shifted above. Due to the one-indexing of Julia, this means that modes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo>±</mo><mi>a</mi><mo separator="true">,</mo><mo>±</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\pm a, \pm b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">±</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">±</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span> are represented by indices <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>b</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[a + 1, b + 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>N</mi><mo>+</mo><mn>1</mn><mo>−</mo><mi>b</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[a + 1, N + 1 - b]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose">]</span></span></span></span>. In our case, the excited modes are associated with</p>
<pre><code class="language-julia">vort_hat&#91;4, 2&#93;</code></pre>
<pre><code class="language-julia">799.089958978059 - 4017.2965085316328im</code></pre>
<p>and</p>
<pre><code class="language-julia">vort_hat&#91;4, 128&#93;</code></pre>
<pre><code class="language-julia">-401.4782067898798 &#43; 4076.2766404493186im</code></pre>
<p>These are the only excited modes, as we can check:</p>
<pre><code class="language-julia">for i in 1:div&#40;N, 2&#41; &#43; 1, j in 1:N
    if abs&#40;vort_hat&#91;i, j&#93;&#41;^2 &gt; eps&#40;&#41;
        println&#40;&quot;vort_hat&#91;&#36;i, &#36;j&#93; &#61; &#36;&#40;vort_hat&#91;i, j&#93;&#41;&quot;&#41;
    end
end</code></pre>
<pre><code class="language-julia">vort_hat&#91;4, 2&#93; &#61; 799.089958978059 - 4017.2965085316328im
vort_hat&#91;4, 128&#93; &#61; -401.4782067898798 &#43; 4076.2766404493186im</code></pre>
<h2 id="differential_operators"><a href="#differential_operators" class="header-anchor">Differential operators</a></h2>
<p>In order to check the derivatives in spectral space, we define the following operators. Actually, they are just vectors, since derivatives in spectral space act as diagonal operators. Hence, a straighforward Hadamard product suffices.</p>
<pre><code class="language-julia">Dx_hat &#61; im * κ₀ * &#91;ifelse&#40;k1 ≤ N/2 &#43; 1, k1 - 1, k1 - 1 - N&#41; for k2 in 1:N/2&#43;1, k1 in 1:N&#93;
Dy_hat &#61; im * κ₀ * &#91;k2 - 1 for k2 in 1:N/2&#43;1, k1 in 1:N&#93;

Delta_hat &#61; - κ₀^2 * &#91;
    ifelse&#40;k1 ≤ N/2 &#43; 1, &#40;k1 - 1&#41;^2 &#43; &#40;k2 - 1&#41;^2, &#40;k1 - 1 - N&#41;^2 &#43; &#40;k2 - 1&#41;^2&#41;
    for k2 in 1:N/2&#43;1, k1 in 1:N
&#93;

Hu_hat &#61; - Dy_hat ./ Delta_hat
Hu_hat&#91;1, 1&#93; &#61; 0.0
Hv_hat &#61; Dx_hat ./ Delta_hat
Hv_hat&#91;1, 1&#93; &#61; 0.0

nothing</code></pre>
<h2 id="testing_the_spectral_operators"><a href="#testing_the_spectral_operators" class="header-anchor">Testing the spectral operators</a></h2>
<p>Now we are ready to test the differentiation in spectral space, with the operators just defined.</p>
<pre><code class="language-julia">@testset &quot;Check operators&quot; begin
    vort_hat &#61; rfft&#40;vort&#41;
    u_hat &#61; Hu_hat .* vort_hat
    v_hat &#61; Hv_hat .* vort_hat
    # check derivative dx in spectral space:
    @test irfft&#40;Dx_hat .* vort_hat, N&#41; ≈ dx_vort
    # check derivative dy in spectral space:
    @test irfft&#40;Dy_hat .* vort_hat, N&#41; ≈ dy_vort
    # check Laplacian in spectral space:
    @test Delta_hat ≈ Dx_hat.^2 .&#43; Dy_hat.^2
    @test irfft&#40;Delta_hat .* vort_hat, N&#41; ≈ dd_vort
    # check recovering velocity field from vorticity
    @test Dx_hat .* v_hat - Dy_hat .* u_hat ≈ vort_hat
end
nothing</code></pre>
<pre><code class="language-julia">Test Summary:   | Pass  Total
Check operators |    5      5</code></pre>
<h2 id="one-mode_steady_state"><a href="#one-mode_steady_state" class="header-anchor">One-mode steady state</a></h2>
<p>For forced-periodic flows, when the forcing function contains a single Fourier mode, there is a corresponding steady state vorticity function corresponding also to that single-mode in Fourier space, only with a different amplitude.</p>
<p>In order to construct such pairs of forcing mode / steady state, we set the viscosity of the flow, choose the mode to be forced and define the strength of that force:</p>
<pre><code class="language-julia">ν &#61; 1.0e-0 # viscosity
κ &#61; &#40;x &#61; 1, y &#61; 2&#41; # forced mode
α &#61; &#40;re &#61; 0.1, im &#61; 0.05&#41; # strength

nothing</code></pre>
<p>With these parameters, we find the curl <code>g_steady</code> of the forcing term and the vorticity <code>vort_steady</code> of the corresponding steady-state:</p>
<pre><code class="language-julia">g_steady &#61; ν * &#40;
    2α.re * κ₀^4 * sum&#40;abs2, κ&#41;^2 * cos.&#40;κ₀ * &#40;κ.x * one.&#40;y&#41; * x&#39; &#43; κ.y * y * one.&#40;x&#41;&#39;&#41;&#41;
    - 2α.im * κ₀^4 * sum&#40;abs2, κ&#41;^2 * sin.&#40;κ₀ * &#40;κ.x * one.&#40;y&#41; * x&#39; &#43; κ.y * y * one.&#40;x&#41;&#39;&#41;&#41;
&#41;

vort_steady &#61; 2κ₀^2 * sum&#40;abs2, κ&#41; * &#40;
    α.re * cos.&#40;κ₀ * &#40;κ.x * one.&#40;y&#41; * x&#39; &#43; κ.y * y * one.&#40;x&#41;&#39;&#41;&#41;
    - α.im * sin.&#40;κ₀ * &#40;κ.x * one.&#40;y&#41; * x&#39; &#43; κ.y * y * one.&#40;x&#41;&#39;&#41;&#41;
&#41;
nothing</code></pre>
<p>Here are some visualizations of the curl of the forcing term and of the vorticity</p>
<pre><code class="language-julia">heatmap&#40;x, y, g_steady, xlabel&#61;&quot;x&quot;, ylabel&#61;&quot;y&quot;, title&#61;&quot;Curl of the forcing term&quot;, titlefont&#61;12&#41;

heatmap&#40;x, y, vort_steady, xlabel&#61;&quot;x&quot;, ylabel&#61;&quot;y&quot;, title&#61;&quot;Steady state vorticity&quot;, titlefont&#61;12&#41;

nothing</code></pre>
<p>The discrete Fourier transform of this vector fields are given as</p>
<pre><code class="language-julia">g_steady_hat &#61; rfft&#40;g_steady&#41;

vort_steady_hat &#61; rfft&#40;vort_steady&#41;

nothing</code></pre>
<h2 id="testing_the_steady_state"><a href="#testing_the_steady_state" class="header-anchor">Testing the steady state</a></h2>
<p>We are now ready to test the steadyness of this vorticity field:</p>
<pre><code class="language-julia">@testset &quot;Check single-mode stable steady state&quot; begin
    u_steady_hat &#61; Hu_hat .* vort_steady_hat
    v_steady_hat &#61; Hv_hat .* vort_steady_hat

    u_steady &#61; irfft&#40;u_steady_hat, N&#41;
    v_steady &#61; irfft&#40;v_steady_hat, N&#41;

    vort_steady_back &#61; irfft&#40;vort_steady_hat, N&#41;

    wu_steady_hat &#61; rfft&#40;vort_steady_back .* u_steady&#41;
    wv_steady_hat &#61; rfft&#40;vort_steady_back .* v_steady&#41;

    rhs_steady &#61; g_steady_hat .&#43; Delta_hat .* vort_steady_hat .- Dx_hat .* wu_steady_hat .- Dy_hat .* wv_steady_hat

    vort_steady_sol_hat &#61; - g_steady_hat ./ Delta_hat
    vort_steady_sol_hat&#91;1, 1&#93; &#61; 0.0im
    # Vanishing bilinear term on one-mode steady state
    @test maximum&#40;abs.&#40;Dx_hat .* wu_steady_hat .&#43; Dy_hat .* wv_steady_hat&#41;&#41; ≤ √eps&#40;&#41;
    # Vanishing RHS on steady state
    @test maximum&#40;abs.&#40;rhs_steady&#41;&#41; ≤ √eps&#40;&#41;
    # Vanishing linear Stokes on steady state
    @test maximum&#40;abs.&#40;g_steady_hat .&#43; Delta_hat .* vort_steady_hat&#41;&#41; ≤ √eps&#40;&#41;

    # Steady state equation
    @test g_steady_hat ≈ - Delta_hat .* vort_steady_hat ≈ - Delta_hat .* vort_steady_hat .- Dx_hat .* wu_steady_hat .- Dy_hat .* wv_steady_hat

    # Steady state solution
    @test vort_steady_sol_hat ≈ vort_steady_hat
end
nothing</code></pre>
<pre><code class="language-julia">Test Summary:                         | Pass  Total
Check single-mode stable steady state |    5      5</code></pre>
<p>All seems good.</p>

    <div class="navbar">
    <p id="nav">
<span id="nav-prev" style="float: left;">
<a class="menu-level-1" href="/2dnsepervortjl/pages/stream">1.4. Stream function <kbd>←</kbd></a>
</span>
<span id="nav-next" style="float: right;">
    <a class="menu-level-1" href="/2dnsepervortjl/pages/literated/tests_fft_plan"><kbd>→</kbd> 6.2. FFTW plans</a>
</span>
    </p>
</div>
</br></br>



<div class="page-foot">
    
        <div class="license">
            <a href=LICENSE>MIT License </a>
            <a href="https://rmsrosa.github.io">(Ricardo M. S. Rosa)</a>
        </div>
    

    Last modified: March 24, 2022. Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>, using the <a href="https://github.com/rmsrosa/booksjl-franklin-template">Book Template</a>.
</div><!-- CONTENT ENDS HERE -->

      </div> <!-- .books-content -->
    </div> <!-- .books-container -->

    
        
        
        
    

    
        <script src="/2dnsepervortjl/libs/highlight/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>
    

  </body>
</html>
